# GAN è®­ç»ƒé—®é¢˜ä¿®å¤æ–¹æ¡ˆ

## ğŸ” é—®é¢˜è¯Šæ–­

### é—®é¢˜ 1: åˆ¤åˆ«å™¨å´©æºƒï¼ˆD Loss â†’ 0ï¼‰
- **ç°è±¡**: D loss åœ¨ 5 ä¸ª epoch å†…ä» 0.4 é™è‡³æ¥è¿‘ 0
- **åæœ**: GAN å¤±å»å¯¹æŠ—æ€§ï¼Œé€€åŒ–ä¸º L1 å›å½’

### é—®é¢˜ 2: GAN Loss ä¸å˜ï¼ˆ~0.98-1.0ï¼‰
- **ç°è±¡**: Generator GAN loss å‡ ä¹æ°´å¹³ä¸å˜
- **åæœ**: ç”Ÿæˆå™¨æ— æ³•ä»å¯¹æŠ—å­¦ä¹ è·å¾—ä¿¡å·

### é—®é¢˜ 3: è¿‡æ‹Ÿåˆï¼ˆTrain â†“ Val â†’ï¼‰
- **ç°è±¡**: è®­ç»ƒ L1 æŒç»­ä¸‹é™ï¼ŒéªŒè¯ L1 æ³¢åŠ¨/ä¸Šå‡
- **åæœ**: æ¨¡å‹èƒŒç­”æ¡ˆï¼Œæ³›åŒ–èƒ½åŠ›å·®

### é—®é¢˜ 4: Train-Val å·®è·æ‰©å¤§
- **ç°è±¡**: Generator Total Loss è®­ç»ƒ/éªŒè¯åˆ†ç¦»
- **åæœ**: æ— æ³•åœ¨éªŒè¯é›†ä¸Šæ³›åŒ–

---

## âœ… ä¿®å¤æ–¹æ¡ˆï¼ˆå·²å®æ–½ï¼‰

### 1. é™ä½ Î»_L1 **ï¼ˆæœ€å…³é”®ï¼ï¼‰**

```python
# ä¿®å¤å‰
'lambda_l1': 100,  # è¿‡å¤§ï¼å‹åˆ¶äº† GAN

# ä¿®å¤å
'lambda_l1': 10,   # è®© GAN å‘æŒ¥ä½œç”¨
```

**åŸç†**: 
- Î»_L1=100 æ—¶ï¼ŒL1 loss å ä¸»å¯¼ï¼ˆ100Ã—L1 >> GAN lossï¼‰
- ç”Ÿæˆå™¨ä¸»è¦ä¼˜åŒ– L1ï¼Œå¿½ç•¥å¯¹æŠ—æ€§
- é™åˆ° 10 åï¼ŒGAN loss å’Œ L1 loss å¹³è¡¡

---

### 2. å‰Šå¼±åˆ¤åˆ«å™¨ï¼ˆé˜²æ­¢ç¢¾å‹ç”Ÿæˆå™¨ï¼‰

```python
# ä¿®å¤å‰
'base_filters': 64,  # G å’Œ D éƒ½æ˜¯ 64
'num_layers': 4,     # G å’Œ D éƒ½æ˜¯ 4 å±‚

# ä¿®å¤å
'base_filters': 64,      # Generator: 64 filters
'base_filters_d': 32,    # Discriminator: 32 filtersï¼ˆå‡åŠï¼‰
'num_layers': 4,         # Generator: 4 layers
'num_layers_d': 3,       # Discriminator: 3 layersï¼ˆå‡1å±‚ï¼‰
```

**åŸç†**:
- åˆ¤åˆ«å™¨å‚æ•°é‡é™ä½ â†’ åˆ¤åˆ«èƒ½åŠ›ä¸‹é™
- é¿å… D åœ¨å‡ ä¸ª epoch å†…"ç§’æ€" G
- D å’Œ G åŠ¿å‡åŠ›æ•Œï¼Œè®­ç»ƒæ›´ç¨³å®š

---

### 3. è°ƒæ•´å­¦ä¹ ç‡ï¼ˆG â†‘ D â†“ï¼‰

```python
# ä¿®å¤å‰
'g_lr': 1e-4,
'd_lr': 2e-4,  # D å­¦ä¹ æ›´å¿« â†’ å®¹æ˜“å´©æºƒ

# ä¿®å¤å
'g_lr': 2e-4,  # æé«˜ G å­¦ä¹ ç‡
'd_lr': 1e-4,  # é™ä½ D å­¦ä¹ ç‡
```

**åŸç†**:
- G å­¦ä¹ æ›´å¿« â†’ èƒ½è·Ÿä¸Š D çš„æ­¥ä¼
- D å­¦ä¹ æ›´æ…¢ â†’ ä¸ä¼šè¿‡æ—©æ”¶æ•›

---

### 4. Label Smoothingï¼ˆè½¯åŒ–æ ‡ç­¾ï¼‰

```python
# ä¿®å¤å‰
real_label = 1.0  # ç¡¬æ ‡ç­¾
fake_label = 0.0

# ä¿®å¤å
'real_label': 0.9,  # è½¯æ ‡ç­¾
'fake_label': 0.1,
```

**ä¿®æ”¹äº† GANLoss ç±»**:
```python
class GANLoss(nn.Module):
    def __init__(self, gan_mode='lsgan', real_label=1.0, fake_label=0.0):
        ...
        self.real_label = real_label
        self.fake_label = fake_label
    
    def forward(self, prediction, target_is_real):
        if target_is_real:
            target = torch.ones_like(prediction) * self.real_label  # 0.9
        else:
            target = torch.ones_like(prediction) * self.fake_label  # 0.1
```

**åŸç†**:
- çœŸå®æ ·æœ¬æ ‡ç­¾ 1.0 â†’ 0.9ï¼ˆå‘Šè¯‰ D"ä¸æ˜¯å®Œç¾çœŸå®"ï¼‰
- å‡æ ·æœ¬æ ‡ç­¾ 0.0 â†’ 0.1ï¼ˆå‘Šè¯‰ D"ä¹Ÿä¸æ˜¯å®Œå…¨å‡"ï¼‰
- é˜²æ­¢ D è¿‡åº¦è‡ªä¿¡ï¼Œå»¶ç¼“å´©æºƒ

---

### 5. å¢å¼ºæ•°æ®å¢å¼º

```python
# ä¿®å¤å‰
noise_std=0.01,
scale_range=(0.95, 1.05),
shift_range=0.05

# ä¿®å¤å
'aug_noise_std': 0.02,        # å™ªå£°æ ‡å‡†å·®åŠ å€
'aug_scale_range': (0.9, 1.1), # ç¼©æ”¾èŒƒå›´æ‰©å¤§
'aug_shift_range': 0.1,        # å¹³ç§»èŒƒå›´åŠ å€
```

**åŸç†**:
- æ›´å¼ºçš„å¢å¼º â†’ æ ·æœ¬å¤šæ ·æ€§å¢åŠ 
- å‡è½»è¿‡æ‹Ÿåˆ
- æé«˜æ³›åŒ–èƒ½åŠ›

---

### 6. å¢åŠ æ—©åœè€å¿ƒå€¼

```python
# ä¿®å¤å‰
'patience': 15,

# ä¿®å¤å
'patience': 20,  # ç»™æ›´å¤šæ—¶é—´æ”¶æ•›
```

**åŸç†**:
- GAN è®­ç»ƒæ³¢åŠ¨å¤§
- éœ€è¦æ›´å¤šè€å¿ƒç­‰å¾…æ”¶æ•›

---

### 7. æ·»åŠ è®­ç»ƒç›‘æ§ï¼ˆå®æ—¶è¯Šæ–­ï¼‰

```python
# åˆ¤åˆ«å™¨å´©æºƒæ£€æµ‹
if train_d_loss < 0.05:
    print("[WARNING] D Loss too low! Discriminator may have collapsed.")

# GAN loss åœæ»æ£€æµ‹
if epoch > 5 and abs(train_g_gan_loss - prev_gan_loss) < 0.01:
    print("[WARNING] GAN Loss stagnant! Adversarial training may not be effective.")
```

**ä½œç”¨**:
- å®æ—¶ç›‘æ§ GAN å¥åº·çŠ¶æ€
- æ—©æœŸå‘ç°å´©æºƒè¿¹è±¡

---

## ğŸ“Š é¢„æœŸæ”¹è¿›æ•ˆæœ

### ä¿®å¤å‰ï¼ˆé—®é¢˜çŠ¶æ€ï¼‰
```
Epoch 5:
  D Loss: 0.02 âš ï¸ (å·²å´©æºƒ)
  GAN Loss: 0.98 âš ï¸ (ä¸å˜)
  Train L1: 0.25 â†“
  Val L1: 0.45 â†’ (ä¸é™åå‡)
```

### ä¿®å¤åï¼ˆé¢„æœŸçŠ¶æ€ï¼‰
```
Epoch 5:
  D Loss: 0.3-0.5 âœ“ (å¥åº·èŒƒå›´)
  GAN Loss: 0.5-0.8 âœ“ (æŒç»­å˜åŒ–)
  Train L1: 0.30 â†“
  Val L1: 0.32 â†“ (åŒæ­¥ä¸‹é™)
```

---

## ğŸ¯ å…³é”®æŒ‡æ ‡ç›‘æ§

è®­ç»ƒæ—¶é‡ç‚¹è§‚å¯Ÿï¼š

1. **D Loss å¥åº·èŒƒå›´**: 0.2 ~ 0.7
   - < 0.1: D è¿‡å¼ºï¼Œå³å°†å´©æºƒ
   - > 1.0: D å¤ªå¼±ï¼ŒG æ¬ºéª—æˆåŠŸ

2. **GAN Loss å˜åŒ–**: åº”è¯¥æŒç»­å˜åŒ–
   - æ°´å¹³çº¿ = GAN ä¸å·¥ä½œ
   - æ³¢åŠ¨ = GAN æ­£å¸¸å¯¹æŠ—

3. **Train L1 vs Val L1**: å·®è·åº”è¯¥å¾ˆå°
   - å·®è· < 0.1: æ­£å¸¸
   - å·®è· > 0.2: è¿‡æ‹Ÿåˆ

4. **Val L1 è¶‹åŠ¿**: åº”è¯¥ä¸‹é™
   - æŒç»­ä¸‹é™ = æ³›åŒ–è‰¯å¥½
   - æ³¢åŠ¨/ä¸Šå‡ = è¿‡æ‹Ÿåˆ

---

## ğŸ”§ å‚æ•°è°ƒä¼˜æŒ‡å—

### å¦‚æœ D ä»ç„¶å´©æºƒï¼ˆD Loss â†’ 0ï¼‰

```python
# è¿›ä¸€æ­¥å‰Šå¼± D
'base_filters_d': 24,    # ä» 32 é™åˆ° 24
'num_layers_d': 2,       # ä» 3 é™åˆ° 2
'd_lr': 5e-5,            # ä» 1e-4 é™åˆ° 5e-5

# æˆ–è¿›ä¸€æ­¥é™ä½ Î»_L1
'lambda_l1': 5,          # ä» 10 é™åˆ° 5
```

### å¦‚æœ G å¤ªå¼±ï¼ˆD Loss > 1.0ï¼‰

```python
# å¢å¼º G
'g_lr': 3e-4,            # ä» 2e-4 æé«˜
'lambda_l1': 20,         # ä» 10 æé«˜ï¼ˆç»™ G æ›´å¤š L1 æŒ‡å¯¼ï¼‰
```

### å¦‚æœä»ç„¶è¿‡æ‹Ÿåˆ

```python
# æ›´å¼ºçš„æ­£åˆ™åŒ–
'dropout_rate': 0.4,     # ä» 0.3 æé«˜
'weight_decay': 5e-5,    # ä» 1e-5 æé«˜

# æ›´å¼ºçš„æ•°æ®å¢å¼º
'aug_noise_std': 0.03,
'aug_scale_range': (0.85, 1.15),
'aug_shift_range': 0.15,
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

1. **train_waveform_gan.py**
   - ä¿®æ”¹ config å‚æ•°
   - æ·»åŠ  label smoothing ä¼ å‚
   - æ·»åŠ è®­ç»ƒç›‘æ§
   - è°ƒæ•´æ¨¡å‹å‚æ•°ä¼ é€’

2. **waveform_models.py**
   - GANLoss ç±»å¢åŠ  label smoothing æ”¯æŒ

3. **waveform_dataset.py**
   - create_waveform_dataloaders å¢åŠ æ•°æ®å¢å¼ºå‚æ•°

---

## âœ… æµ‹è¯•ä¿®å¤

è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼š
```bash
python test_training_quick.py
```

å¼€å§‹è®­ç»ƒï¼š
```bash
python train_waveform_gan.py
```

---

## ğŸ¯ æˆåŠŸæ ‡å¿—

è®­ç»ƒæˆåŠŸçš„æ ‡å¿—ï¼š

âœ… D Loss ç¨³å®šåœ¨ 0.2-0.7 ä¹‹é—´  
âœ… GAN Loss æŒç»­å˜åŒ–ï¼ˆä¸æ˜¯æ°´å¹³çº¿ï¼‰  
âœ… Train L1 å’Œ Val L1 åŒæ­¥ä¸‹é™  
âœ… Train L1 å’Œ Val L1 å·®è· < 0.1  
âœ… æ²¡æœ‰ "WARNING" æç¤º  

å¦‚æœæ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œè¯´æ˜ GAN è®­ç»ƒæ­£å¸¸ï¼
